; @layout "post"
; @title "Deployatron"

<p><i>This post was originally written for the <a href="http://hyvesblogonproductdevelopment.blogspot.nl/2012/03/deployatron.html">Hyves Product Development</a> blog</i></p>

<div dir="ltr" style="text-align: left;" trbidi="on"><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-L_BkUynf90s/T3BjiQ5XtFI/AAAAAAAAAAU/Z0HDiCflN_c/s1600/big.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://1.bp.blogspot.com/-L_BkUynf90s/T3BjiQ5XtFI/AAAAAAAAAAU/Z0HDiCflN_c/s320/big.jpg" width="320" /></a><span style="text-align: left;">&nbsp;</span></div>One of the cool things about working at <a href="http://en.wikipedia.org/wiki/Hyves">Hyves</a> is the regular hackathons.  The Hyves hackathons are two days where employees can work on projects entirely of their own devising.  Typically this results in small teams forming around an idea and trying to produce a working prototype in two days.  These events are fun, and a lot can be learned and achieved in the time.<br />
<br />
At the last hackathon, our team (<a href="http://konstantinov.hyves.nl/">Alexander</a>, <a href="http://chrisjwilson.hyves.nl/">Chris</a>, <a href="http://matias-cascallares.hyves.nl/">Matias</a> and <a href="http://errebepe.hyves.nl/">Rodrigo</a>) decided to produce a piece of hardware rather than software.  The concept started off simply; we wanted a big, red, fifties-looking button we could use to deploy the entire Hyves system.  It grew from there.<br />
<br />
<h3 style="text-align: left;">The vision</h3>With a little brainstorming prior to the hackathon, we came up with a more complete concept.  The vision was now to produce a Deployatron.  This would have the following features:<br />
<ul><li>Integrate with our existing, <a href="http://jenkins-ci.org/">Jenkins</a> based, build and deploy  process<br />
</li>
<li>Able to do the two major deploy workflows (deploying the  staging and live versions of the site)<br />
</li>
<li>Look retro-cool<br />
</li>
</ul>So we got hold of an <a href="http://en.wikipedia.org/wiki/Arduino">Arduino</a>, bought the best looking components we could find and set to work.<br />
<br />
<div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-Vu3y3RBsjHw/T3Bm2N21HbI/AAAAAAAAAA8/r_TE-UoqALE/s1600/diagram.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://1.bp.blogspot.com/-Vu3y3RBsjHw/T3Bm2N21HbI/AAAAAAAAAA8/r_TE-UoqALE/s320/diagram.jpg" width="320" /></a></div><h3 style="text-align: left;">The design</h3><div class="separator" style="clear: both; text-align: center;"></div>The first thing we did was get together and do a bit of design.  We started off with some system design.  We decided that we needed four things: integration with Jenkins, a piece of software running on the Deploymeister's<a href="#footnote">*</a> computer to act as a middle-man, some software on the Arduino and the actual hardware.  We decided to keep the Arduino firmware as minimal as possible, and focus the intelligence in the middle layer.<br />
<br />
<h3 style="text-align: left;">The build</h3><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-W1XRXW7gL-Q/T3BjlgWsEFI/AAAAAAAAAAs/WHRNwLrBXlU/s1600/openbox.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://3.bp.blogspot.com/-W1XRXW7gL-Q/T3BjlgWsEFI/AAAAAAAAAAs/WHRNwLrBXlU/s320/openbox.jpg" width="320" /></a></div>We had several tasks to complete, so we defined some minimal APIs between them and set to work.  Matias soon had the Jenkins integration under control using the excellent <a href="https://github.com/salimfadhley/jenkinsapi">jenkinsapi</a> library.  Alexander set to work on the middleware using Python and Twisted to create an event driven system to talk to the Arduino's serial port.  Chris started plugging LEDs into the Arduino and remembering how to solder.  By the end of day one we had a working prototype set up, talking via the middleware to the Jenkins server and responding with its flashing LEDs.<br />
<div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-1qZ0cxkOJic/T3BqEugRP6I/AAAAAAAAABc/1pNbZVCzXAE/s1600/jenkins.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-1qZ0cxkOJic/T3BqEugRP6I/AAAAAAAAABc/1pNbZVCzXAE/s1600/jenkins.png" /></a></div><br />
The next day we got onto polishing the system.  Matias and Rodrigo started work on the case, drilling, cutting and the like, Alexander started putting the finishing touches to the Arduino firmware and Chris started the soldering.  With help from various people (William, Sofie) by 4:30pm we had a 90% working system with the following features:<br />
<ul><li>Ability to switch between two work-flows<br />
</li>
<li>Flashing red/green LEDs to indicate build and deploy process<br />
</li>
<li>Button to build the branch<br />
</li>
<li>Button that lights up red when it's possible to deploy (when  there was a good, recent, build)<br />
</li>
<li>Two key switches to “arm” the deployatron<br />
</li>
</ul>All this in a nice looking box, with event-driven middleware communicating between it and Jenkins.<br />
<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/--78U2HieaBw/T3BjjYlS8EI/AAAAAAAAAAY/smIYqzNlQA0/s1600/gettingthere.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://4.bp.blogspot.com/--78U2HieaBw/T3BjjYlS8EI/AAAAAAAAAAY/smIYqzNlQA0/s320/gettingthere.jpg" width="320" /></a></div><br />
<h3 style="text-align: left;">The future</h3>The Deployatron has been used by the Deploymeister to build and deploy the site.  There are a few bugs to work out, but its generally functioning fine.  In addition, there are a bunch of possible things we might want to do with this in the future:<br />
<ul><li>Integrate some other features of the build process –  rollback, for instance<br />
</li>
<li>Make the Deployatron network based, so the software doesn't  need to be installed on the Deploymeister's computer<br />
</li>
<li>Put the middleware directly into a Jenkins plugin, possibly  with the ability to just specify which pins which switches and which  LEDs are on and what processes they should respond to/start<br />
</li>
<li>Add indicators for other things – state of the unit tests,  for instance</li>
</ul><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-463fko6QPPo/T3BsHs3AUOI/AAAAAAAAABk/6C2PChxyf8Y/s1600/hand.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://1.bp.blogspot.com/-463fko6QPPo/T3BsHs3AUOI/AAAAAAAAABk/6C2PChxyf8Y/s320/hand.jpg" width="320" /></a></div><h4 style="text-align: left;">Footnote</h4><a name="footnote">*</a> The Deploymeister is the developer responsible for building and deploying the site in a given week.  This role is shared by all developers in a rotating system.</div>

